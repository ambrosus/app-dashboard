<!--
  Copyright: Ambrosus Technologies GmbH
  Email: tech@ambrosus.com
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
  This Source Code Form is “Incompatible With Secondary Licenses”, as defined by the Mozilla Public License, v. 2.0.
-->
<header class="header" [ngClass]="{ 'advancedSearch': advancedSearch }">
  <div class="wrapper">
    <div class="logo"><a routerLink="/"></a></div>

    <div class="menu">
      <!-- Desktop menu -->
      <nav *ngIf="!advancedSearch">
        <ul>
          <li *ngIf="checkPermission(['super_account'])">
            <a routerLink="/node" routerLinkActive="active">Node</a>
          </li>
          <li *ngIf="checkPermission(['manage_accounts'])">
            <a routerLink="/organization" routerLinkActive="active">Organizations</a>
          </li>
          <li><a routerLink="/assets" routerLinkActive="active">Assets</a></li>
        </ul>
      </nav>
      <!-- Search (simple) -->
      <form class="form search" [formGroup]="forms.search" (ngSubmit)="search()">
        <a class="advanced" (click)="advancedSearch = !advancedSearch">{{
          advancedSearch ? 'close' : 'advanced'
        }}</a>
        <input formControlName="input" type="search" placeholder="Search Assets (by ID or Text)" />
      </form>
    </div>

    <div class="avatar" [appToggleClass]="'openMenu'">
      <div>{{ account.email ? account.email.charAt(0) : account.address.charAt(2) }}</div>
      <app-drop-down [items]="dropDownItems"></app-drop-down>
    </div>
  </div>

  <!-- Search (advanced) -->
  <div class="searchAdvanced" *ngIf="advancedSearch">
    <form class="form center" [formGroup]="forms.searchAdvance" (ngSubmit)="search()" (keydown.enter)="$event.preventDefault()">
      <div class="group">
        <label class="w25">
          <span>Created from</span>
          <input type="date" formControlName="from" />
        </label>
        <label class="w25">
          <span>To</span>
          <input type="date" formControlName="to" />
        </label>
        <label class="w50">
          <span>Asset state</span>
          <div class="tags" formArrayName="state">
            <div class="tag" *ngFor="let tag of forms.searchAdvance.get('state')['controls']; let i = index">
              {{ tag.value }}
              <a class="remove" (click)="remove('state', i)">&times;</a>
            </div>
            <input type="text" (keyup)="addTag($event, tagInput)" placeholder="ie. sold" #tagInput />
          </div>
        </label>
      </div>
      <h5 class="left" style="margin-bottom: 25px;">Identifiers</h5>
      <div formArrayName="identifiers" class="right">
        <div class="group" *ngFor="let identifier of forms.searchAdvance.get('identifiers')['controls']; let i = index" [formGroupName]="i">
          <label class="w50">
            <span>Name</span>
            <input formControlName="name" [appAutocompleteinput]="{ control: identifier.get('name'), array: autocomplete }" type="text" />
          </label>
          <label class="w50">
            <span>Value</span>
            <input formControlName="value" type="text" />
            <a class="remove" (click)="remove('identifiers', i)" *ngIf="i !== 0">&times;</a>
          </label>
        </div>
        <a class="addMore" (click)="addIdentifier()">+ Add more</a>
      </div>

      <h5 class="left" style="margin: 30px 0;">Location</h5>
      <div formGroupName="location" style="margin-bottom: 40px">
        <div class="group">
          <label class="w50">
            <span>City</span>
            <input formControlName="city" type="text" />
          </label>
          <label class="w50">
            <span>Country</span>
            <input formControlName="country" type="text" />
          </label>
        </div>
        <div class="group">
          <label class="w50">
            <span>GLN</span>
            <input formControlName="gln" type="text" />
          </label>
          <label class="w50">
            <span>Location ID</span>
            <input formControlName="locationId" type="text" />
          </label>
        </div>
        <div class="group">
          <label class="w50">
            <span>Latitude</span>
            <input formControlName="lat" type="number" />
          </label>
          <label class="w50">
            <span>Longitude</span>
            <input formControlName="lng" type="number" />
          </label>
        </div>
      </div>
      <button type="submit">Search</button>
    </form>
  </div>
</header>

<div class="overlay" *ngIf="advancedSearch" (click)="advancedSearch = false"></div>
