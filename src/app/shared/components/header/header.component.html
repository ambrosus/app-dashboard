<!--
  Copyright: Ambrosus Technologies GmbH
  Email: tech@ambrosus.com
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
  This Source Code Form is “Incompatible With Secondary Licenses”, as defined by the Mozilla Public License, v. 2.0.
-->
<header class="header" [ngClass]="{ advancedSearch: advancedSearch }">
  <div class="wrapper">
    <div class="logo"><a routerLink="/"></a></div>

    <div class="menu">
      <!-- Desktop menu -->
      <nav *ngIf="!advancedSearch">
        <ul>
          <li *ngIf="checkPermission(['super_account'])">
            <a routerLink="/node" routerLinkActive="active">Node</a>
          </li>
          <li *ngIf="checkPermission(['manage_accounts'])">
            <a routerLink="/organization" routerLinkActive="active"
              >Organizations</a
            >
          </li>
          <li><a routerLink="/assets" routerLinkActive="active">Assets</a></li>
        </ul>
      </nav>
      <!-- Search (simple) -->
      <form
        class="form search"
        [formGroup]="forms.search"
        (ngSubmit)="search()"
      >
        <a class="advanced" (click)="advancedSearch = !advancedSearch">{{
          advancedSearch ? 'close' : 'advanced'
        }}</a>
        <input
          formControlName="input"
          type="search"
          placeholder="Search Assets (by ID or Text)"
        />
      </form>
    </div>

    <div class="avatar">
      <div>
        {{
          account.email ? account.email.charAt(0) : account.address.charAt(2)
        }}
      </div>
    </div>
  </div>

  <!-- Search (advanced) -->
  <div class="header__advancedSearch" *ngIf="advancedSearch">
    <form
      class="form center"
      [formGroup]="forms.searchAdvance"
      (ngSubmit)="search()"
      (keydown.enter)="$event.preventDefault()"
    >
      <div class="group">
        <label class="w25"
          >Created from <input type="date" formControlName="from" />
        </label>
        <label class="w25"
          >To <input type="date" formControlName="to" />
        </label>
        <label class="w50"
          >Asset state
          <div class="tags" formArrayName="state">
            <div
              class="tag"
              *ngFor="
                let tag of forms.searchAdvance.get('state')['controls'];
                let i = index
              "
            >
              {{ tag.value }}
              <a class="remove" (click)="remove('state', i)">&times;</a>
            </div>
            <input type="text" (keyup)="addTag($event, tagInput)" #tagInput />
          </div>
        </label>
      </div>
      <div formArrayName="identifiers" class="right">
        <div
          class="group"
          *ngFor="
            let identifier of forms.searchAdvance.get('identifiers')[
              'controls'
            ];
            let i = index
          "
          [formGroupName]="i"
        >
          <label class="w50"
            >Identifier name
            <input
              formControlName="name"
              [appAutocompleteinput]="{
                control: identifier.get('name'),
                array: identifiersAutocomplete
              }"
              type="text"
            />
          </label>
          <label class="w50"
            >Value <input formControlName="value" type="text" />
            <a class="remove" (click)="remove('identifiers', i)" *ngIf="i !== 0"
              >&times;</a
            >
          </label>
        </div>
        <a class="addMore" (click)="addIdentifier()">+ Add more</a>
      </div>

      <h5 class="left" style="margin: 30px 0;">Location</h5>
      <div formGroupName="location" style="margin-bottom: 40px">
        <div class="group">
          <label class="w50"
            >City <input formControlName="city" type="text" />
          </label>
          <label class="w50"
            >Country <input formControlName="country" type="text" />
          </label>
        </div>
        <div class="group">
          <label class="w50"
            >GLN <input formControlName="gln" type="text" />
          </label>
          <label class="w50"
            >Location ID <input formControlName="locationId" type="text" />
          </label>
        </div>
        <div class="group">
          <label class="w50"
            >Latitude <input formControlName="lat" type="number" />
          </label>
          <label class="w50"
            >Longitude <input formControlName="lng" type="number" />
          </label>
        </div>
      </div>
      <button type="submit">Search</button>
    </form>
  </div>
</header>

<div
  class="overlay"
  *ngIf="advancedSearch"
  (click)="advancedSearch = false"
></div>
