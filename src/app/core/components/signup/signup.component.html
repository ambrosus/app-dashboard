<!--
Copyright: Ambrosus Technologies GmbH
Email: tech@ambrosus.com
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
This Source Code Form is “Incompatible With Secondary Licenses”, as defined by the Mozilla Public License, v. 2.0.
-->
<div class="wrapper">

  <!-- STEP 1 -->
  <div *ngIf="step === 'keysOptions'">
    <h2 class="card__title">{{ invite ? 'Welcome to ' + invite.organization.title : 'Registration' }}</h2>
    <p class="card__body">Public/private key is required to access the blockchain and complete transactions. You are free to either register your own key or use our secure key generator. Don't worry, in either case, we <b>do not</b> store your private key.</p>

    <div class="card animated fadeInDown">
      <div class="card__header center" style="padding: 30px 30px 0;">
        <button type="button" class="button button--blue" (click)="step = 'keysGenerate'">Register my own key</button>
        <p style="margin: 10px 0;">OR</p>
        <button type="button" class="button button--blue" (click)="generateKeys()">Generate keys for me</button>
        <small style="margin: 10px 0; display: block;">By proceeding I agree to your Terms of Service.</small>
        <p class="card_body" *ngIf="error">{{ error }}</p>
      </div>

      <div class="additional-options">
        <a></a>
        <a routerLink="/login">I want to sign in</a>
      </div>
    </div>
  </div>

  <!-- STEP 2 -->
  <div *ngIf="step === 'keysGenerate'">
    <h2 class="card__title">Registration</h2>
    <p class="card__body">Public/private key is required to access the blockchain and complete transactions. You are free to either register your own key or use our secure key generator. Don't worry, in either case, we <b>do not</b> store your private key.</p>

    <div class="card animated fadeInDown">
      <div class="card__header">
        <app-tabs>
          <app-tab label="Private/public keys">
            <form [formGroup]="forms.secretForm" (ngSubmit)="verifyAccount()">
              <label>Secret
                <input formControlName="secret" type="text" spellcheck="false" #secret (keyup)="generateAddress(secret)">
              </label>
              <label>Address
                <input formControlName="address" type="text" spellcheck="false">
              </label>
              <button type="button" class="button" (click)="downloadJSON()" style="border: 2px solid green; color: green">Download keystore file (JSON)</button>
              <label style="margin: 10px 0; user-select: none;">
                <input type="checkbox" formControlName="saved"> I saved my keys
              </label>
              <button type="submit" class="button button--blue" [disabled]="!forms.secretForm.valid" [promiseBtn]="promiseAction">Next</button>
            </form>
          </app-tab>
        </app-tabs>
        <p class="card_body" *ngIf="error">{{ error }}</p>
      </div>

      <div class="additional-options">
        <a></a>
        <a routerLink="/login">I want to sign in</a>
      </div>
    </div>
  </div>

  <!-- STEP 3 -->
  <div *ngIf="step === 'requestForm'">
    <h2 class="card__title">Almost done...</h2>
    <p class="card__body">For better user experience and access to all dashboard features please share a few details. You can skip this step and complete it later.</p>

    <div class="card animated fadeInDown">
      <div class="card__header">
        <app-tabs>
          <app-tab label="User information">
            <form [formGroup]="forms.requestForm" (ngSubmit)="requestOrganization()">
              <label>Your organization title (optional)
                <input formControlName="title" type="text" spellcheck="false">
              </label>
              <label>Your email
                <input formControlName="email" type="email" spellcheck="false">
              </label>
              <label>What makes you interested in our solution?
                <textarea formControlName="message" style="max-width: 100%;"></textarea>
              </label>
              <label style="user-select: none;">
                <input formControlName="terms" type="checkbox"> I have read and accepted your Terms of Service
              </label>
              <button type="submit" class="button button--blue" [disabled]="!forms.requestForm.valid" [promiseBtn]="promiseAction">Continue</button>
            </form>
          </app-tab>
        </app-tabs>
        <p class="card_body" *ngIf="error">{{ error }}</p>
      </div>

      <div class="additional-options">
        <a (click)="step = 'keysGenerate'">Back to keys</a>
        <a routerLink="/login">I want to sign in</a>
      </div>
    </div>
  </div>

  <!-- STEP 4 - SUCCESS -->
  <div class="card animated fadeInDown" *ngIf="step === 'success'" style="padding: 30px;">
    <h2 class="card__title">Thank you!</h2>
    <p class="card__body">Your application has been successfully submitted for approval. Once reviewed, we will send you an e-mail.</p>
    <hr>
  </div>
</div>
