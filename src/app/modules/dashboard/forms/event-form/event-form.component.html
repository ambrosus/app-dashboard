<!--
Copyright: Ambrosus Technologies GmbH
Email: tech@ambrosus.com
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
This Source Code Form is “Incompatible With Secondary Licenses”, as defined by the Mozilla Public License, v. 2.0.
-->
<div class="m-w-6 block-center p-v-20" [ngClass]="{error: error, success: success}">

  <h4 class="center p-h-40 m-b-30" *ngIf="error" style="color: #ea7070">{{ error }}</h4>
  <h4 class="center p-h-40 m-b-30" *ngIf="success" style="color: #5cb85c">{{ success }}</h4>

  <form [formGroup]="eventForm" (ngSubmit)="save()" class="form-group" autocomplete="off">

    <div class="accordions">

      <div class="accordion">
        <h5 class="accordion__title active" appAccordion>
          <span>Basic info</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content active">
          <div class="form-text m-b-20">
            <label for="type">Event type</label>
            <input formControlName="type" type="text" id="type" spellcheck="false" appInput>
          </div>
          <div class="form-text m-b-20">
            <label for="name">Name</label>
            <input formControlName="name" type="text" id="name" spellcheck="false" appInput>
          </div>
          <div class="form-text m-b-20">
            <label for="description">Description (optional)</label>
            <input formControlName="description" type="text" id="description" spellcheck="false" appInput>
          </div>
          <div class="form-text m-b-20">
            <label for="accessLevel">Access Level</label>
            <input formControlName="accessLevel" type="number" min="0" id="accessLevel" spellcheck="false" appInput>
          </div>
        </div>
      </div>

      <div class="accordion">
        <h5 class="accordion__title" appAccordion>
          <span>Documents</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content">
          <div formArrayName="documents">
            <div *ngFor="let documentCtrl of eventForm.get('documents')['controls']; let i = index" [formGroupName]="i" class="right">
              <div class="form-fields-coupled">
                <div class="form-text m-b-20 m-r-20 w-40">
                  <label for="{{ i + 'documentTitle' }}">Document title</label>
                  <input formControlName="documentTitle" type="text" id="{{ i + 'documentTitle' }}" spellcheck="false" appInput>
                </div>
                <div class="form-text m-b-20 w-60">
                  <label for="{{ i + 'documentUrl' }}">Document url</label>
                  <input formControlName="documentUrl" type="text" id="{{ i + 'documentUrl' }}" spellcheck="false" appInput>
                </div>
              </div>
              <a class="color-greys--base m-b-20 inline-block" (click)="remove('documents', i)">Remove</a>
            </div>
            <a class="color-ablue--base" (click)="addDocument()">Add document</a>
          </div>
        </div>
      </div>

      <div class="accordion">
        <h5 class="accordion__title" appAccordion>
          <span>Key-value</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content">
          <div formArrayName="customData">
            <div *ngFor="let customDataCtrl of eventForm.get('customData')['controls']; let i = index" [formGroupName]="i" class="right">
              <div class="form-fields-coupled">
                <div class="form-text m-b-20 m-r-20 w-40">
                  <label for="{{ i + 'customDataKey'}}">Property name</label>
                  <input formControlName="customDataKey" type="text" id="{{ i + 'customDataKey'}}" spellcheck="false" appInput>
                </div>
                <div class="form-text m-b-20 w-60">
                  <label for="{{ i + 'customDataValue'}}">Value</label>
                  <input formControlName="customDataValue" type="text" id="{{ i + 'customDataValue'}}" spellcheck="false" appInput>
                </div>
              </div>
              <a class="color-greys--base m-b-20 inline-block" (click)="remove('customData', i)">Remove</a>
            </div>
            <a class="color-ablue--base" (click)="addCustomKeyValue()">Add key-value pair</a>
          </div>
        </div>
      </div>

      <div class="accordion">
        <h5 class="accordion__title" appAccordion>
          <span>Groups</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content">
          <div formArrayName="customDataGroups">
            <div *ngFor="let customDataGroupCtrl of eventForm.get('customDataGroups')['controls']; let i = index" [formGroupName]="i" class="right">
              <div class="form-text m-b-20">
                <label for="{{ i + 'groupName'}}">Group name</label>
                <input formControlName="groupName" type="text" id="{{ i + 'groupName'}}" spellcheck="false" appInput>
              </div>
              <p class="m-t-30 m-b-20 left">Group data (key-value pairs)</p>
              <!--start Array of key-value in a group-->
              <div formArrayName="groupValue" class="left">
                <div *ngFor="let customDataGroupPairCtrl of customDataGroupCtrl.get('groupValue')['controls']; let j = index" [formGroupName]="j" class="right">
                  <div class="form-fields-coupled">
                    <div class="form-text m-b-20 m-r-20 w-40">
                      <label for="{{ j + 'groupItemKey'}}">Property name</label>
                      <input formControlName="groupItemKey" type="text" id="{{ j + 'groupItemKey'}}" spellcheck="false" appInput>
                    </div>
                    <div class="form-text m-b-20 w-60">
                      <label for="{{ j + 'groupItemValue'}}">Value</label>
                      <input formControlName="groupItemValue" type="text" id="{{ j + 'groupItemValue'}}" spellcheck="false" appInput>
                    </div>
                  </div>
                  <a class="color-greys--base m-b-20 inline-block" (click)="onRemoveCustomGroupKeyValue(i, j)">Remove</a>
                </div>
                <a class="color-ablue--base" (click)="addCustomGroupKeyValue(i)">Add key-value pair</a>
              </div>
              <!--end Array of key-value in a group-->
              <a class="color-blacks--base m-b-20 inline-block" (click)="remove('customDataGroups', i)">Remove group</a>
            </div>
            <a class="color-ablue--base" (click)="addCustomGroup()">Add new group</a>
          </div>
        </div>
      </div>

      <div class="accordion">
        <h5 class="accordion__title" appAccordion>
          <span>Event identifiers</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content">
          <div formArrayName="identifiers">
            <div *ngFor="let identifierCtrl of eventForm.get('identifiers')['controls']; let i = index" [formGroupName]="i" class="right">
              <div class="form-fields-coupled">
                <div class="form-text m-b-20 m-r-20 w-30">
                  <label for="{{ i + 'identifier'}}">Identifier</label>
                  <input formControlName="identifier" [appAutocompleteinput]="{control: identifierCtrl, array: identifiersAutocomplete}" type="text" id="{{ i + 'identifier'}}" spellcheck="false" appInput>
                </div>
                <div class="form-text m-b-20 w-70">
                  <label for="{{ i + 'identifierValue'}}">Value</label>
                  <input formControlName="identifierValue" type="text" id="{{ i + 'identifierValue'}}" spellcheck="false" appInput>
                </div>
              </div>
              <a class="color-greys--base m-b-20 inline-block" (click)="remove('identifiers', i)">Remove</a>
            </div>
            <a class="color-ablue--base" (click)="addIdentifier()">Add indentifier</a>
          </div>
        </div>
      </div>

      <div class="accordion">
        <h5 class="accordion__title" appAccordion>
          <span>Event location</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content" formGroupName="locationEvent">
          <div class="form-text m-b-20">
            <label for="name">Name</label>
            <input formControlName="name" type="text" id="name" spellcheck="false" appInput>
          </div>
          <div class="form-fields-coupled">
            <div class="form-text m-b-20 w-50 m-r-10">
              <label for="city">City</label>
              <input formControlName="city" type="text" id="city" spellcheck="false" appInput>
            </div>
            <div class="form-text m-b-20 w-50">
              <label for="country">Country</label>
              <input formControlName="country" type="text" id="country" spellcheck="false" appInput>
            </div>
          </div>
          <div class="form-fields-coupled">
            <div class="form-text m-b-20 w-50 m-r-10">
              <label for="locationid">Location id</label>
              <input formControlName="locationId" type="text" id="locationid" spellcheck="false" appInput>
            </div>
            <div class="form-text m-b-20 w-50">
              <label for="gln">GLN</label>
              <input formControlName="GLN" type="text" id="gln" spellcheck="false" appInput>
            </div>
          </div>
          <div formGroupName="location">
            <p class="m-b-10">Geometry</p>
            <div formGroupName="geometry">
              <div formArrayName="coordinates">
                <div *ngFor="let geometryGroup of eventForm.get('locationEvent').get('location').get('geometry').get('coordinates')['controls']; let i = index" [formGroupName]="i">
                  <div class="form-fields-coupled">
                    <div class="form-text m-b-20 w-50 m-r-10">
                      <label for="lat">Latitude</label>
                      <input formControlName="lat" type="number" id="lat" spellcheck="false" appInput>
                    </div>
                    <div class="form-text m-b-20 w-50">
                      <label for="lng">Longitude</label>
                      <input formControlName="lng" type="number" id="lng" spellcheck="false" appInput>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="accordion">
        <h5 class="accordion__title" appAccordion>
          <span>Asset location</span>
          <img src="/assets/raster/arrow-down.png">
        </h5>
        <div class="accordion__content" formGroupName="locationAsset">
          <div class="form-text m-b-20">
            <label for="name">Name</label>
            <input formControlName="name" type="text" id="name" spellcheck="false" appInput>
          </div>
          <div class="form-fields-coupled">
            <div class="form-text m-b-20 w-50 m-r-10">
              <label for="city">City</label>
              <input formControlName="city" type="text" id="city" spellcheck="false" appInput>
            </div>
            <div class="form-text m-b-20 w-50">
              <label for="country">Country</label>
              <input formControlName="country" type="text" id="country" spellcheck="false" appInput>
            </div>
          </div>
          <div class="form-fields-coupled">
            <div class="form-text m-b-20 w-50 m-r-10">
              <label for="locationid">Location id</label>
              <input formControlName="locationId" type="text" id="locationid" spellcheck="false" appInput>
            </div>
            <div class="form-text m-b-20 w-50">
              <label for="gln">GLN</label>
              <input formControlName="GLN" type="text" id="gln" spellcheck="false" appInput>
            </div>
          </div>
          <div formGroupName="location">
            <p class="m-b-10">Geometry</p>
            <div formGroupName="geometry">
              <div formArrayName="coordinates">
                <div *ngFor="let geometryGroup of eventForm.get('locationAsset').get('location').get('geometry').get('coordinates')['controls']; let i = index" [formGroupName]="i">
                  <div class="form-fields-coupled">
                    <div class="form-text m-b-20 w-50 m-r-10">
                      <label for="lat">Latitude</label>
                      <input formControlName="lat" type="number" id="lat" spellcheck="false" appInput>
                    </div>
                    <div class="form-text m-b-20 w-50">
                      <label for="lng">Longitude</label>
                      <input formControlName="lng" type="number" id="lng" spellcheck="false" appInput>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="flex flex-direction-r justify-content-fe align-items-c m-b-50 m-t-20">
      <app-spinner *ngIf="spinner"></app-spinner>
      <button type="submit" class="button button--blue m-l-20">{{ prefill ? 'Edit event' : 'Create event' }}</button>
    </div>
  </form>

</div>
