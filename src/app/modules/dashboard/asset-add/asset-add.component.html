<main class="main m-t-50">
  <h4 class="center p-h-40 m-b-30" *ngIf="error" style="color: #ea7070">Please fill all empty fields.</h4>
  <h4 class="center p-h-40 m-b-30" *ngIf="invalidJSON" style="color: #ea7070">Your JSON is invalid, please fix it first.</h4>
  <h4 class="center p-h-40 m-b-30" *ngIf="success" style="color: #5cb85c">Success!</h4>
  <h4 class="center p-h-40 m-b-30" *ngIf="errorResponse" style="color: #ea7070">Error creating the asset</h4>

  <div *ngIf="isDialog">
    <h1 *ngIf="infoEvent" style="display:inline;" class="center">Edit info event</h1>
    <h1 *ngIf="!infoEvent" style="display:inline;" class="center">Edit event</h1>
    <img (click)="closeDialog()" style="height: 20px; width: 20px; cursor: pointer; position: relative; left: 350; bottom: 10;"
      src="/assets/raster/close.png">
    <hr>
  </div>

  <div class="tabs">
    <div class="tab_header">
      <p class="tab_header_item active" (click)="tabOpen('form', tabForm)" #tabForm>Form</p>
      <p class="tab_header_item" *ngIf="!prefill" (click)="tabOpen('json', tabJSON)" #tabJSON>JSON</p>
    </div>
    <div class="tab_content">

      <!-- JSON -->
      <div class="m-w-6 block-center right p-a-20" [ngClass]="{error: error || invalidJSON, success: success}" *ngIf="json && !prefill">
        <label for="file" class="abtn btn-outline-ablue m-b-10" *ngIf="json">Upload JSON</label>
        <input type="file" id="file" class="srt" accept=".json" name="file" *ngIf="json" (change)="uploadJSON($event)" #file>
        <textarea id="jsonInput" class="jsonInput" placeholder="Insert JSON" spellcheck="false" (keyup)="validJSON(jsonInput)" (keydown)="insertTab($event, jsonInput)"
          #jsonInput [ngClass]="{ invalid: errorJSON }" [value]="textArea"></textarea>
        <div class="flex flex-direction-r justify-content-fe align-items-c m-b-50 m-t-20">
          <app-spinner *ngIf="spinner"></app-spinner>
          <a class="abtn m-l-20 btn-solid-ablue" (click)="onJSONSave(jsonInput)">Create asset</a>
        </div>
      </div>

      <!-- FORM -->
      <div class="m-w-6 block-center p-v-20" [ngClass]="{error: error, success: success}" *ngIf="!json">
        <form [formGroup]="assetForm" (ngSubmit)="onSave()" class="form-group" autocomplete="off">

          <div class="accordions">

            <div class="accordion">
              <h5 class="accordion__title active" appAccordion>
                <span>Basic info</span>
                <img src="/assets/raster/arrow-down.png">
              </h5>
              <div class="accordion__content active">
                <div class="form-text m-b-20">
                  <label for="assetType">Asset type *</label>
                  <input formControlName="assetType" type="text" id="assetType" spellcheck="false" appInput>
                </div>
                <div class="form-text m-b-20">
                  <label for="name">Name *</label>
                  <input formControlName="name" type="text" id="name" spellcheck="false" appInput>
                </div>
                <div class="form-text m-b-20">
                  <label for="description">Description</label>
                  <input formControlName="description" type="text" id="description" spellcheck="false" appInput>
                </div>
              </div>
            </div>

            <div class="accordion">
              <h5 class="accordion__title" appAccordion>
                <span>Images</span>
                <img src="/assets/raster/arrow-down.png">
              </h5>
              <div class="accordion__content">
                <div formArrayName="productImage">
                  <div *ngFor="let productImageCtrl of assetForm.get('productImage')['controls']; let i = index" [formGroupName]="i" class="right">
                    <div class="form-fields-coupled">
                      <div class="form-text m-b-20 m-r-20 w-40" [ngClass]="{full: i === 0}">
                        <label for="{{ i + 'imageName' }}">Image name</label>
                        <input [attr.disabled]="i === 0 ? '': null" formControlName="imageName" type="text" id="{{ i + 'imageName' }}" spellcheck="false"
                          appInput>
                      </div>
                      <div class="form-text m-b-20 w-60">
                        <label for="{{ i + 'imageUrl' }}">Image url</label>
                        <input formControlName="imageUrl" type="text" id="{{ i + 'imageUrl' }}" spellcheck="false" appInput>
                      </div>
                    </div>
                    <a class="color-greys--base m-b-20 inline-block" (click)="remove('productImage', i)" *ngIf="i > 0">Remove</a>
                  </div>
                  <a class="color-ablue--base" (click)="addImageUrl()">Add image</a>
                </div>
              </div>
            </div>

            <div class="accordion">
              <h5 class="accordion__title" appAccordion>
                <span>Asset identifiers</span>
                <img src="/assets/raster/arrow-down.png">
              </h5>
              <div class="accordion__content">
                <div formArrayName="identifiers">
                  <div *ngFor="let identifierCtrl of assetForm.get('identifiers')['controls']; let i = index" [formGroupName]="i" class="right">
                    <div class="form-fields-coupled">
                      <div class="form-text m-b-20 m-r-20 w-30">
                        <label for="{{ i + 'identifier'}}">Identifier</label>
                        <input formControlName="identifier" [appAutocompleteinput]="{control: identifierCtrl, array: identifiersAutocomplete}" type="text"
                          id="{{ i + 'identifier'}}" spellcheck="false" appInput>
                      </div>
                      <div class="form-text m-b-20 w-70">
                        <label for="{{ i + 'identifierValue'}}">Value</label>
                        <input formControlName="identifierValue" type="text" id="{{ i + 'identifierValue'}}" spellcheck="false" appInput>
                      </div>
                    </div>
                    <a class="color-greys--base m-b-20 inline-block" (click)="remove('identifiers', i)">Remove</a>
                  </div>
                  <a class="color-ablue--base" (click)="addIdentifier()">Add indentifier</a>
                </div>
              </div>
            </div>

            <div class="accordion">
              <h5 class="accordion__title" appAccordion>
                <span>Key-value</span>
                <img src="/assets/raster/arrow-down.png">
              </h5>
              <div class="accordion__content">
                <div formArrayName="customData">
                  <div *ngFor="let customDataCtrl of assetForm.get('customData')['controls']; let i = index" [formGroupName]="i" class="right">
                    <div class="form-fields-coupled">
                      <div class="form-text m-b-20 m-r-20 w-40">
                        <label for="{{ i + 'customDataKey'}}">Property name</label>
                        <input formControlName="customDataKey" type="text" id="{{ i + 'customDataKey'}}" spellcheck="false" appInput>
                      </div>
                      <div class="form-text m-b-20 w-60">
                        <label for="{{ i + 'customDataValue'}}">Value</label>
                        <input formControlName="customDataValue" type="text" id="{{ i + 'customDataValue'}}" spellcheck="false" appInput>
                      </div>
                    </div>
                    <a class="color-greys--base m-b-20 inline-block" (click)="remove('customData', i)">Remove</a>
                  </div>
                  <a class="color-ablue--base" (click)="addCustomKeyValue()">Add key-value pair</a>
                </div>
              </div>
            </div>

            <div class="accordion">
              <h5 class="accordion__title" appAccordion>
                <span>Groups</span>
                <img src="/assets/raster/arrow-down.png">
              </h5>
              <div class="accordion__content">
                <div formArrayName="customDataGroups">
                  <div *ngFor="let customDataGroupCtrl of assetForm.get('customDataGroups')['controls']; let i = index" [formGroupName]="i"
                    class="right">
                    <div class="form-text m-b-20">
                      <label for="{{ i + 'groupName'}}">Group name</label>
                      <input formControlName="groupName" type="text" id="{{ i + 'groupName'}}" spellcheck="false" appInput>
                    </div>
                    <p class="m-t-30 m-b-20 left">Group data (key-value pairs)</p>
                    <!--start Array of key-value in a group-->
                    <div formArrayName="groupValue" class="left">
                      <div *ngFor="let customDataGroupPairCtrl of customDataGroupCtrl.get('groupValue')['controls']; let j = index" [formGroupName]="j"
                        class="right">
                        <div class="form-fields-coupled">
                          <div class="form-text m-b-20 m-r-20 w-40">
                            <label for="{{ j + 'groupItemKey'}}">Property name</label>
                            <input formControlName="groupItemKey" type="text" id="{{ j + 'groupItemKey'}}" spellcheck="false" appInput>
                          </div>
                          <div class="form-text m-b-20 w-60">
                            <label for="{{ j + 'groupItemValue'}}">Value</label>
                            <input formControlName="groupItemValue" type="text" id="{{ j + 'groupItemValue'}}" spellcheck="false" appInput>
                          </div>
                        </div>
                        <a class="color-greys--base m-b-20 inline-block" (click)="onRemoveCustomGroupKeyValue(i, j)">Remove</a>

                      </div>
                      <a class="color-ablue--base" (click)="addCustomGroupKeyValue(i)">Add key-value pair</a>
                    </div>
                    <!--end Array of key-value in a group-->
                    <a class="color-blacks--base m-b-20 inline-block" (click)="remove('customDataGroups', i)">Remove group</a>
                  </div>
                  <a class="color-ablue--base" (click)="addCustomGroup()">Add new group</a>
                </div>
              </div>
            </div>
          </div>

          <div class="flex flex-direction-r justify-content-fe align-items-c m-b-50 m-t-20">
            <app-spinner *ngIf="spinner"></app-spinner>
            <button type="submit" class="abtn m-l-20 btn-solid-ablue">{{ buttonText }}</button>
          </div>
        </form>

      </div>

    </div>
  </div>

  <!--TEST ONLY-->
  <!-- <pre *ngIf="json">
    {{json}}
  </pre> -->
</main>
