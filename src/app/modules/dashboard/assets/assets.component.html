<!--
Copyright: Ambrosus Technologies GmbH
Email: tech@ambrosus.com
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
This Source Code Form is “Incompatible With Secondary Licenses”, as defined by the Mozilla Public License, v. 2.0.
-->

<main class="main">
  <div class="wrapper">

    <!-- Search bar -->
    <h2 class="center m-t-30">All assets</h2>
    <p class="center m-b-30">Total count: {{ (assetsActive ? resultCountAsset : resultCountSearch) || 0 }}</p>

    <div class="block-center m-w-6 p-h-10">
      <div class="search">
        <select id="select">
          <option value="name" selected>name</option>
          <option value="createdBy">createdBy</option>
          <option value="asset identifiers">asset identifiers</option>
          <option value="event identifiers">event identifiers</option>
          <option value="type">type</option>
        </select>
        <input type="text" id="search" class="grey-placeholder" placeholder="{{ searchPlaceholder }}">
        <a class="abtn btn-solid-ablue" (click)="search()">Search</a>
      </div>
      <p class="center m-t-10">Separate multiple entries with comma, ie. GTN: 123, GLN: 1234 (identifiers)</p>

    </div>
  </div>

  <h5 class="color-greys--base p-h-20 center m-t-50" *ngIf="noEvents">No assets with info event. :/</h5>

  <div class="table">
    <!-- Header -->
    <!-- Select all -->
    <div class="table__item table__item__header" style="border-bottom: 1px solid #f1f1f1; border-radius: 0; z-index: 3;">
      <label class="table__label table__label__heading" for="selectAll" (click)="onSelectAll($event, input)">
        <div class="relative">
          <input type="checkbox" id="selectAll" class="table__checkbox" appOnchecked #input>
          <svg class="checkbox-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path fill="#5078f1" d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path>
          </svg>
        </div>
        <span class="capitalize color-ablue--base">{{ selectAllText }}</span>
      </label>
      <!-- Bulk actions -->
      <div class="table__label table__label__heading table__label__select color-ablue--base">
        <select id="selectBulkActions" (change)="bulkActions(selectBulkActions)" #selectBulkActions>
          <option value="default" disabled>Bulk actions</option>
          <option value="createEvent">Create Event</option>
        </select>
      </div>
      <!-- Refresh -->
      <button class="abtn btn-outline-ablue m-l-auto" routerLink="/assets/new">Create Asset <app-svg-icon class="p-l-10" width="17px" height="17px" name="add-icon"></app-svg-icon></button>
    </div>

    <div class="table__item table__item__header header--sticky" appSticky [addClass]="'sticky'">
      <div style="width: 100px; height: 10px; flex: 0 0 100px;"></div>
      <div style="width: 100px; height: 10px; flex: 0 0 100px;"></div>
      <p class="table__column table__column__header">Title</p>
      <p class="table__column table__column__header">Created by</p>
      <p class="table__column table__column__header">Timestamp</p>
    </div>

    <div class="table__item__gapFill" appSticky [offsetTop]="80" [addClass]="'gapFill'"></div>
  </div>

  <app-assets-loader-indicator *ngIf="!searchNoResultsFound && loader"></app-assets-loader-indicator>

  <h4 class="color-greys--base center p-h-20 m-t-20" *ngIf="searchActive && searchNoResultsFound">No results found</h4>

  <div class="table m-t-20 p-h-30" id="table">

    <!-- Items -->
    <div class="table__item table" *ngFor="let asset of assets.assets; let i = index">
      <label class="table__label" for="{{ i }}">
        <div class="relative">
          <input type="checkbox" id="{{ i }}" (click)="checkAsset(asset.assetId)" appOnchecked class="table__checkbox" name="{{asset.assetId}}">
          <svg class="checkbox-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path fill="#5078f1" d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path>
          </svg>
        </div>
      </label>

      <div class="table__column__image">
        <a href="https://amb.to/{{asset.assetId}}" target="_blank">
          <img src="./assets/raster/link.png">
        </a>
      </div>

      <div class="table__column" routerLink="{{asset.assetId}}">
        <p class="table__column-title hide-1024">Title</p>
        <div *ngIf="asset.info && findInfo(asset.info) !== 'undefined'">
          <p class="table__column-content">{{ findInfo(asset.info).name }}</p>
          <p class="table__column-meta">{{ asset.assetId }}</p>
        </div>
        <div *ngIf="!asset.info || findInfo(asset.info) === 'undefined'">
          <p class="table__column-content">{{ asset.assetId }}</p>
        </div>
      </div>

      <div class="table__column" routerLink="{{asset.assetId}}">
        <p class="table__column-title hide-1024">Created by</p>
        <p class="table__column-content">{{ asset.content.idData.createdBy }}</p>
      </div>

      <div class="table__column" routerLink="{{asset.assetId}}">
        <p class="table__column-title hide-1024">Timestamp</p>
        <p class="table__column-content">{{ asset.content.idData.timestamp * 1000 | date:'d MMM yyyy HH:mm'}}</p>
      </div>
    </div>

    <div class="block-center m-w-12 m-v-10 p-h-10">
      <div *ngIf="assetsActive && pagination.length !== 0">
        Showing {{ (currentAssetPage - 1) * perPage + 1 }} to
        <span *ngIf="currentAssetPage * perPage > resultCountAsset">{{ resultCountAsset }}</span>
        <span *ngIf="currentAssetPage * perPage <= resultCountAsset">{{ currentAssetPage * perPage }}</span> of {{ resultCountAsset }} assets
      </div>
      <div *ngIf="searchActive && pagination.length !== 0 && !searchNoResultsFound">
        Showing {{ (currentSearchPage - 1) * perPage + 1 }} to
        <span *ngIf="currentSearchPage * perPage > resultCountSearch">{{ resultCountSearch }}</span>
        <span *ngIf="currentSearchPage * perPage <= resultCountSearch">{{ currentSearchPage * perPage }}</span> of {{ resultCountSearch }} assets
      </div>
    </div>

    <!-- Pagination -->
    <div class="block-center m-w-12 m-t-10 p-h-10">
      <!-- Asset pagination -->
      <app-pagination *ngIf="assetsActive && !searchActive" [currentPage]="currentAssetPage" [totalPages]="totalAssetPages" [method]="loadAssets"></app-pagination>
      <!-- Search pagination -->
      <app-pagination *ngIf="searchActive && !searchNoResultsFound" [currentPage]="currentSearchPage" [totalPages]="totalSearchPages" [method]="search"></app-pagination>
    </div>
  </div>
</main>
