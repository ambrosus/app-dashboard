<!--
Copyright: Ambrosus Technologies GmbH
Email: tech@ambrosus.com
This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
If a copy of the MPL was not distributed with this file, You can obtain one at https://mozilla.org/MPL/2.0/.
This Source Code Form is “Incompatible With Secondary Licenses”, as defined by the Mozilla Public License, v. 2.0.
-->
<main class="main">
  <div class="wrapper">

    <!-- Search bar -->
    <h2 class="center m-t-30">All assets</h2>
    <p class="center m-b-30">Total count: {{ pagination.resultCount || 0 }}</p>

    <div class="block-center m-w-6 p-h-10">
      <div class="search">
        <select id="select">
          <option value="name" selected>name</option>
          <option value="createdBy">createdBy</option>
          <option value="type">type</option>
        </select>
        <input type="text" id="search" class="grey-placeholder" placeholder="{{ searchPlaceholder }}">
        <button type="button" class="button button--blue" (click)="search()">Search</button>
      </div>
      <p class="center m-t-10">Separate multiple entries with comma, ie. GTN: 123, GLN: 1234 (identifiers)</p>

    </div>
  </div>

  <div class="table">
    <!-- Header -->
    <!-- Select all -->
    <div class="table__item table__item__header">
      <label class="table__label table__label__heading" for="selectAll" (click)="onSelectAll($event, input)">
        <label class="table__label">
          <input type="checkbox" id="selectAll" appCustomCheckbox #input>
        </label>
        <span class="capitalize color-ablue--base">{{ selectAllText }}</span>
      </label>
      <!-- Bulk actions -->
      <div class="table__label table__label__heading table__label__select color-ablue--base">
        <select id="selectBulkActions" (change)="bulkActions(selectBulkActions)" #selectBulkActions>
          <option value="default" disabled>Bulk actions</option>
          <option value="createEvent">Create Event</option>
        </select>
      </div>
      <button type="button" class="button button--blue m-l-auto" routerLink="/assets/new">Create Asset</button>
    </div>

    <div class="table__item table__item__header header--sticky" appSticky [addClass]="'sticky'">
      <div style="width: 100px; height: 10px; flex: 0 0 100px;"></div>
      <div style="width: 100px; height: 10px; flex: 0 0 100px;"></div>
      <p class="table__column table__column__header">Title</p>
      <p class="table__column table__column__header">Timestamp</p>
      <p class="table__column table__column__header">Status</p>
    </div>

    <div class="table__item__gapFill" appSticky [offsetTop]="80" [addClass]="'gapFill'"></div>
  </div>

  <app-assets-loader-indicator *ngIf="loader"></app-assets-loader-indicator>

  <h4 class="color-greys--base center p-h-20 m-t-20" *ngIf="searchActive && assets.length === 0">No results found</h4>

  <div class="table m-t-20 p-h-30" id="table">

    <!-- Items -->
    <div class="table__item table" *ngFor="let asset of assets; let i = index" (click)="onSelect($event, element)" id="{{ asset.assetId }}" #element>
      <label class="table__label" for="{{ i }}">
        <input type="checkbox" appCustomCheckbox>
      </label>

      <div class="table__column__image">
        <a href="https://amb.to/{{asset.assetId}}" target="_blank">
          <img src="./assets/raster/link.png">
        </a>
      </div>

      <div class="table__column" [routerLink]="asset.assetId">
        <p class="table__column-title hide-1024">Title</p>
        <div *ngIf="JSONparse(asset.infoEvent)">
          <p class="table__column-content">{{ getName(asset.infoEvent, 'No title') }}</p>
          <p class="table__column-meta">{{ asset.assetId }}</p>
        </div>
        <div *ngIf="!JSONparse(asset.infoEvent)">
          <p class="table__column-content">{{ asset.assetId }}</p>
        </div>
      </div>

      <div class="table__column" [routerLink]="asset.assetId">
        <p class="table__column-title hide-1024">Timestamp</p>
        <p class="table__column-content">{{ asset.createdAt | date:'d MMM yyyy HH:mm'}}</p>
      </div>

      <div class="table__column" [routerLink]="asset.assetId">
        <p class="table__column-title hide-1024">Status</p>
        <p class="table__column-content">{{ getName(asset.latestEvent, 'Created') }}</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="block-center m-w-12 m-t-10 p-h-10">
    <!-- Search pagination -->
    <app-pagination *ngIf="searchActive" [pagination]="pagination" [method]="search"></app-pagination>
    <!-- Asset pagination -->
    <app-pagination *ngIf="!searchActive" [pagination]="pagination" [method]="loadAssets"></app-pagination>
  </div>
</main>
